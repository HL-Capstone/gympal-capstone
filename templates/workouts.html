{% extends "base.html" %}
{% block content %}
<h1 class="h4 mb-3 d-flex align-items-center justify-content-between">
  <span>Workouts</span>
  <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('export_csv') }}">
    Download CSV
  </a>
</h1>

<form method="post" class="card card-body mb-4">
  <div class="row g-3">
    <div class="col-md-3">
      <label class="form-label">Date</label>
      <input type="date"
             name="date"
             class="form-control"
             required
             value="{{ form.date or '' }}">
    </div>

    <div class="col-md-3">
      <label class="form-label">Exercise</label>
      <input list="exerciseList"
             name="exercise"
             class="form-control"
             placeholder="Start typing…"
             required
             value="{{ form.exercise or '' }}">
      <datalist id="exerciseList">
        {% for name in ex_names %}
          <option value="{{ name }}"></option>
        {% endfor %}
      </datalist>
    </div>

    <div class="col-md-2">
      <label class="form-label">Reps</label>
      <input type="number"
             name="reps"
             class="form-control"
             min="1"
             required
             value="{{ form.reps or '' }}">
    </div>

    <div class="col-md-2">
      <label class="form-label">Weight</label>
      <input type="number"
             step="0.5"
             name="weight"
             class="form-control"
             min="0"
             value="{{ form.weight or '' }}">
      <div class="form-text">Leave blank for bodyweight.</div>
    </div>

    <div class="col-12">
      <label class="form-label">Notes (optional)</label>
      <input type="text"
             name="notes"
             class="form-control"
             value="{{ form.notes or '' }}">
    </div>
  </div>
  <div class="mt-3">
    <button class="btn btn-primary">Add Workout</button>
  </div>
</form>

<ul class="list-group">
  {% for w, sets in workouts %}
    <li class="list-group-item">
      <div class="d-flex justify-content-between">
        <strong>{{ w.date }}</strong>
        <small class="text-muted">{{ w.notes }}</small>
      </div>

      <ul class="mt-2">
        {% for s, ex in sets %}
          <li>
            {{ ex.name }} — {{ s.reps }} reps @ {{ s.weight if s.weight is not none else "bodyweight" }}
            <small class="ms-2">
              <a class="btn btn-sm btn-outline-primary"
                 href="{{ url_for('edit_set', set_id=s.id) }}">Edit</a>
              <form method="post"
                    action="{{ url_for('delete_set', set_id=s.id) }}"
                    class="d-inline ms-1"
                    onsubmit="return confirm('Delete this entry? This cannot be undone.');">
                <button class="btn btn-sm btn-outline-danger" type="submit">Delete</button>
              </form>
            </small>
          </li>
        {% endfor %}
      </ul>
    </li>
  {% else %}
    <li class="list-group-item">No workouts yet.</li>
  {% endfor %}
</ul>
{% endblock %}
